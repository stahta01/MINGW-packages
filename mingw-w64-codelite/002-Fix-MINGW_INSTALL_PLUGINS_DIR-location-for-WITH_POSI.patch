From 2ba0092e16e8de26f4ddbaa8f681443947ee0f71 Mon Sep 17 00:00:00 2001
From: Tim Stahlhut <stahta01@gmail.com>
Date: Tue, 21 Oct 2025 11:05:09 -0400
Subject: Fix MINGW_INSTALL_PLUGINS_DIR location for WITH_POSIX_LAYOUT

---
 CMakeLists.txt                 | 7 ++++++-
 CodeLite/cl_standard_paths.cpp | 2 +-
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index ae26e8bf2..b33ee6f6a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -333,7 +333,11 @@ endif()
 # Define the PLUGINS_DIR variable
 if(MINGW)
   # MinGW
-  set(MINGW_INSTALL_PLUGINS_DIR "${CMAKE_INSTALL_PREFIX}/plugins")
+  if(WITH_POSIX_LAYOUT)
+      set(MINGW_INSTALL_PLUGINS_DIR "${CMAKE_INSTALL_PREFIX}/lib/codelite")
+  else()
+      set(MINGW_INSTALL_PLUGINS_DIR "${CMAKE_INSTALL_PREFIX}/plugins")
+  endif()
   set(MINGW_INSTALL_BIN "${CMAKE_INSTALL_PREFIX}")
 endif()
 
@@ -578,6 +582,7 @@ if(NOT MINGW)
   add_compile_definitions(PLUGINS_DIR=\"${PLUGINS_DIR}\")
 else()
   if(WITH_POSIX_LAYOUT)
+    add_compile_definitions(PLUGINS_DIR=\"${PLUGINS_DIR}\")
     add_compile_definitions(NDEBUG)
     add_compile_definitions(USE_POSIX_LAYOUT)
   endif()
diff --git a/CodeLite/cl_standard_paths.cpp b/CodeLite/cl_standard_paths.cpp
index d7d079c7a..09a46e4eb 100644
--- a/CodeLite/cl_standard_paths.cpp
+++ b/CodeLite/cl_standard_paths.cpp
@@ -148,7 +148,7 @@ wxString clStandardPaths::GetPluginsDirectory() const
     wxString pluginsDir = PLUGINS_DIR;
 #else
 #ifdef USE_POSIX_LAYOUT
-    wxFileName path(GetInstallDir() + wxT(PLUGINS_DIR), "");
+    wxFileName path(wxT(PLUGINS_DIR), "");
 #else
     wxFileName path(GetDataDir(), "");
     path.AppendDir("plugins");
-- 
2.48.1.windows.1

